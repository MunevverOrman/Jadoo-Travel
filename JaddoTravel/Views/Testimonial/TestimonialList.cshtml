@model List<JadooTravel.Dtos.TestimonialDtos.ResultTestimonialDto>
@{
    ViewData["Title"] = "Müşteri Görüşleri";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="row mt-4">
    <div class="col-12">
        <div class="card">

            <!-- BAŞLIK -->
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="fw-semibold mb-0">Müşteri Görüşleri</h5>
                <span class="badge bg-primary">
                    Toplam: @Model?.Count
                </span>
            </div>

            <!-- TABLO -->
            <div class="card-body table-responsive">
                <table class="table table-striped table-bordered align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>Ad Soyad</th>
                            <th>Yorum</th>
                            <th>Fotoğraf</th>
                            <th style="width: 150px;">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            var i = 1;
                            foreach (var item in Model)
                            {
                                <tr>
                                    <td>@i</td>
                                    <td>@item.NameSurname</td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(item.Comment) && item.Comment.Length > 80)
                                        {
                                            @item.Comment.Substring(0, 80)
                                         
                                                                        }
                                        else
                                        {
                                            @item.Comment
                                        }
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrWhiteSpace(item.ImageUrl))
                                        {
                                            <img src="@item.ImageUrl"
                                                 width="50" height="50"
                                                 class="rounded-circle object-fit-cover"
                                                 onerror="this.src='/public/assets/img/testimonial/author.png'" />
                                        }
                                        else
                                        {
                                            <img src="/public/assets/img/testimonial/author.png"
                                                 width="50" height="50"
                                                 class="rounded-circle object-fit-cover" />
                                        }
                                    </td>
                                    <td>
                                        <div class="d-flex gap-2">
                                            <a asp-controller="Testimonial"
                                               asp-action="UpdateTestimonial"
                                               asp-route-id="@item.TestimonialId"
                                               class="btn btn-sm btn-info">
                                                Düzenle
                                            </a>

                                            <button type="button"
                                                    class="btn btn-sm btn-danger text-white"
                                                    onclick="deleteTestimonial('@item.TestimonialId')">
                                                Sil
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                i++;
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="5" class="text-center text-muted py-4">
                                    Henüz sistemde kayıtlı bir müşteri görüşü bulunmuyor.
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>

                <!-- BUTON SOL ALTA -->
                <div class="mt-3">
                    <a asp-controller="Testimonial"
                       asp-action="CreateTestimonial"
                       class="btn btn-primary">
                        Yeni Görüş Ekle
                    </a>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function deleteTestimonial(id) {
        Swal.fire({
            title: "Silmek istediğinize emin misiniz?",
            text: "Bu işlem geri alınamaz.",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#e74c3c",
            cancelButtonColor: "#3085d6",
            confirmButtonText: "Evet, sil",
            cancelButtonText: "Vazgeç"
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = "/Testimonial/DeleteTestimonial?id=" + id;
            }
        });
    }
</script>
